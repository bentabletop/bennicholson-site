---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const items = (await getCollection("writing")).sort(
  (a, b) => (b.data.date?.getTime() ?? 0) - (a.data.date?.getTime() ?? 0)
);

const sections = [
  { key: "feature", label: "Feature articles" },
  { key: "interview", label: "Interviews" },
  { key: "review", label: "Reviews" },
  { key: "fiction", label: "Fiction" },
] as const;

type SectionKey = (typeof sections)[number]["key"];

const byType: Record<SectionKey, typeof items> = {
  feature: items.filter((p) => p.data.type === "feature"),
  interview: items.filter((p) => p.data.type === "interview"),
  review: items.filter((p) => p.data.type === "review"),
  fiction: items.filter((p) => p.data.type === "fiction"),
};

const fmt = (d?: Date) =>
  d ? d.toLocaleDateString("en-GB", { year: "numeric", month: "short" }) : "";
---

<BaseLayout title="Writing · Ben Nicholson" description="Writing" currentPath="/writing">
  <section class="hero">
    <div class="kicker"><span class="dot" aria-hidden="true"></span><span>Writing</span></div>
    <h1>Writing</h1>
    <p class="lede">A selection of favourite pieces for a variety of publications from across the past decade. Work is grouped by format.</p>
  </section>

  {sections.map((section) => {
    const posts = byType[section.key];

    return (
      <section class="section">
        <h2>{section.label}</h2>

        {posts.length === 0 ? (
          <div class="list">
            <div class="row">
              <div class="meta">—</div>
              <div>
                <div class="title">Nothing here yet</div>
                <div class="desc">
                  Add an item with <code>type: {section.key}</code> in <code>src/content/writing/</code>.
                </div>
              </div>
            </div>
          </div>
        ) : (
          <div class="list">
            {posts.map((p) => (
              <div class="row">
                <div class="meta">{fmt(p.data.date)}</div>
                <div>
                  <div class="title">
                    {p.data.url ? (
                      <a href={p.data.url} target="_blank" rel="noopener">
                        {p.data.title}
                      </a>
                    ) : (
                      <span>{p.data.title}</span>
                    )}
                  </div>
                  <div class="desc">
                    {p.data.outlet ? <span>{p.data.outlet}</span> : null}
                    {p.data.description ? <span> — {p.data.description}</span> : null}
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
      </section>
    );
  })}
</BaseLayout>
